<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>斐波那契数列计算 | 慢八拍の博客</title>
    <meta name="description" content="慢八拍的私人博客，仅作为学习成果的记录与总结">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.b43ad9b6.css" as="style"><link rel="preload" href="/blog/assets/js/app.b560a9ee.js" as="script"><link rel="preload" href="/blog/assets/js/2.465c49ea.js" as="script"><link rel="preload" href="/blog/assets/js/64.c47f0ec2.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b92c5624.js"><link rel="prefetch" href="/blog/assets/js/11.9fdd4fa0.js"><link rel="prefetch" href="/blog/assets/js/12.cd94c2e9.js"><link rel="prefetch" href="/blog/assets/js/13.5b41bce2.js"><link rel="prefetch" href="/blog/assets/js/14.fa342c23.js"><link rel="prefetch" href="/blog/assets/js/15.314e9b9c.js"><link rel="prefetch" href="/blog/assets/js/16.bfb01263.js"><link rel="prefetch" href="/blog/assets/js/17.b4e3fb56.js"><link rel="prefetch" href="/blog/assets/js/18.261c3d38.js"><link rel="prefetch" href="/blog/assets/js/19.117defc3.js"><link rel="prefetch" href="/blog/assets/js/20.f52ff07d.js"><link rel="prefetch" href="/blog/assets/js/21.a2b10669.js"><link rel="prefetch" href="/blog/assets/js/22.479e926d.js"><link rel="prefetch" href="/blog/assets/js/23.dba2b62e.js"><link rel="prefetch" href="/blog/assets/js/24.d6a3bd26.js"><link rel="prefetch" href="/blog/assets/js/25.d758452b.js"><link rel="prefetch" href="/blog/assets/js/26.2252f2b9.js"><link rel="prefetch" href="/blog/assets/js/27.0a3af6d9.js"><link rel="prefetch" href="/blog/assets/js/28.10880793.js"><link rel="prefetch" href="/blog/assets/js/29.93c15754.js"><link rel="prefetch" href="/blog/assets/js/3.44856348.js"><link rel="prefetch" href="/blog/assets/js/30.2976867e.js"><link rel="prefetch" href="/blog/assets/js/31.90077d17.js"><link rel="prefetch" href="/blog/assets/js/32.5040470b.js"><link rel="prefetch" href="/blog/assets/js/33.e72166c5.js"><link rel="prefetch" href="/blog/assets/js/34.c50a7662.js"><link rel="prefetch" href="/blog/assets/js/35.b3965b29.js"><link rel="prefetch" href="/blog/assets/js/36.d98cbffe.js"><link rel="prefetch" href="/blog/assets/js/37.a1a177c3.js"><link rel="prefetch" href="/blog/assets/js/38.6d546a3a.js"><link rel="prefetch" href="/blog/assets/js/39.a6f90fe6.js"><link rel="prefetch" href="/blog/assets/js/4.903d47a9.js"><link rel="prefetch" href="/blog/assets/js/40.27446a44.js"><link rel="prefetch" href="/blog/assets/js/41.34baa793.js"><link rel="prefetch" href="/blog/assets/js/42.84ae0f85.js"><link rel="prefetch" href="/blog/assets/js/43.ae479153.js"><link rel="prefetch" href="/blog/assets/js/44.2153b298.js"><link rel="prefetch" href="/blog/assets/js/45.43705845.js"><link rel="prefetch" href="/blog/assets/js/46.516d39b1.js"><link rel="prefetch" href="/blog/assets/js/47.ebc5464a.js"><link rel="prefetch" href="/blog/assets/js/48.32c83e07.js"><link rel="prefetch" href="/blog/assets/js/49.0971dc11.js"><link rel="prefetch" href="/blog/assets/js/5.4e775f96.js"><link rel="prefetch" href="/blog/assets/js/50.32552bd3.js"><link rel="prefetch" href="/blog/assets/js/51.b01dd074.js"><link rel="prefetch" href="/blog/assets/js/52.9fda750f.js"><link rel="prefetch" href="/blog/assets/js/53.f394e7e7.js"><link rel="prefetch" href="/blog/assets/js/54.dd407329.js"><link rel="prefetch" href="/blog/assets/js/55.c153e374.js"><link rel="prefetch" href="/blog/assets/js/56.7a7d3e13.js"><link rel="prefetch" href="/blog/assets/js/57.5fd18b65.js"><link rel="prefetch" href="/blog/assets/js/58.0b98c064.js"><link rel="prefetch" href="/blog/assets/js/59.8670e5ba.js"><link rel="prefetch" href="/blog/assets/js/6.d5b6aa0e.js"><link rel="prefetch" href="/blog/assets/js/60.074ab1e7.js"><link rel="prefetch" href="/blog/assets/js/61.17f1b1f5.js"><link rel="prefetch" href="/blog/assets/js/62.320ea960.js"><link rel="prefetch" href="/blog/assets/js/63.e1d292be.js"><link rel="prefetch" href="/blog/assets/js/65.7fc66f8b.js"><link rel="prefetch" href="/blog/assets/js/66.69883841.js"><link rel="prefetch" href="/blog/assets/js/67.a372f1fb.js"><link rel="prefetch" href="/blog/assets/js/68.34f15fc2.js"><link rel="prefetch" href="/blog/assets/js/69.79092013.js"><link rel="prefetch" href="/blog/assets/js/7.2e2c7a99.js"><link rel="prefetch" href="/blog/assets/js/70.04839a8e.js"><link rel="prefetch" href="/blog/assets/js/71.3d54ab62.js"><link rel="prefetch" href="/blog/assets/js/72.d175e94b.js"><link rel="prefetch" href="/blog/assets/js/73.d9eb411b.js"><link rel="prefetch" href="/blog/assets/js/74.2967098f.js"><link rel="prefetch" href="/blog/assets/js/75.be31a493.js"><link rel="prefetch" href="/blog/assets/js/76.3db8d08b.js"><link rel="prefetch" href="/blog/assets/js/77.794b3963.js"><link rel="prefetch" href="/blog/assets/js/78.de200e53.js"><link rel="prefetch" href="/blog/assets/js/79.6b401ba5.js"><link rel="prefetch" href="/blog/assets/js/8.925ce3f7.js"><link rel="prefetch" href="/blog/assets/js/80.afac74c2.js"><link rel="prefetch" href="/blog/assets/js/81.a949f8bc.js"><link rel="prefetch" href="/blog/assets/js/82.ffb183ad.js"><link rel="prefetch" href="/blog/assets/js/83.74c9d49b.js"><link rel="prefetch" href="/blog/assets/js/84.299ddf66.js"><link rel="prefetch" href="/blog/assets/js/85.c2d2381f.js"><link rel="prefetch" href="/blog/assets/js/9.c9fbc570.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b43ad9b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">慢八拍の博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/js/" class="nav-link router-link-active">JavaScript 笔记</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">CSS 笔记</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">Vue 笔记</a></div><div class="nav-item"><a href="/blog/imooc/" class="nav-link">慕课网笔记</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">杂记</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/js/" class="nav-link router-link-active">JavaScript 笔记</a></div><div class="nav-item"><a href="/blog/css/" class="nav-link">CSS 笔记</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">Vue 笔记</a></div><div class="nav-item"><a href="/blog/imooc/" class="nav-link">慕课网笔记</a></div><div class="nav-item"><a href="/blog/others/" class="nav-link">杂记</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript 笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js/" class="sidebar-link">介绍</a></li><li><a href="/blog/js/prototype.html" class="sidebar-link">原型与原型链</a></li><li><a href="/blog/js/class.html" class="sidebar-link">创建对象的多种方法总结</a></li><li><a href="/blog/js/extends.html" class="sidebar-link">继承的多种方法总结</a></li><li><a href="/blog/js/fibonacci.html" class="active sidebar-link">斐波那契数列计算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_1-普通递归" class="sidebar-link">1.普通递归</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_2-正向叠加" class="sidebar-link">2.正向叠加</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_3-动态规划" class="sidebar-link">3.动态规划</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_4-memoization" class="sidebar-link">4.Memoization</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_5-memoization-封装" class="sidebar-link">5.Memoization 封装</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_6-underscore-中的-memoize" class="sidebar-link">6.underscore 中的 _.memoize</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_7-尾递归" class="sidebar-link">7.尾递归</a></li><li class="sidebar-sub-header"><a href="/blog/js/fibonacci.html#_8-通项公式" class="sidebar-link">8.通项公式</a></li></ul></li><li><a href="/blog/js/bracket.html" class="sidebar-link">关于函数后括号省略的探究</a></li><li><a href="/blog/js/bind.html" class="sidebar-link">bind 函数</a></li><li><a href="/blog/js/debounce.html" class="sidebar-link">防抖函数</a></li><li><a href="/blog/js/throttle.html" class="sidebar-link">节流函数</a></li><li><a href="/blog/js/async.html" class="sidebar-link">async</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="斐波那契数列计算"><a href="#斐波那契数列计算" class="header-anchor">#</a> 斐波那契数列计算</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1-普通递归">1.普通递归</a></li><li><a href="#_2-正向叠加">2.正向叠加</a></li><li><a href="#_3-动态规划">3.动态规划</a></li><li><a href="#_4-memoization">4.Memoization</a></li><li><a href="#_5-memoization-封装">5.Memoization 封装</a></li><li><a href="#_6-underscore-中的-memoize">6.underscore 中的 _.memoize</a></li><li><a href="#_7-尾递归">7.尾递归</a></li><li><a href="#_8-通项公式">8.通项公式</a></li></ul></div><p></p> <p>斐波那契数列是：1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...。<br>
这个数列从第3项开始，每一项都等于前两项之和。<br>
在数学上，斐波那契数列以递推的方法定义：<code>F(1) = 1, F(2) = 1, F(n) = F(n-1) + F(n-2) (n &gt;= 2)</code>。</p> <h2 id="_1-普通递归"><a href="#_1-普通递归" class="header-anchor">#</a> 1.普通递归</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">?</span> n <span class="token punctuation">:</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 1530.710205078125ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 堆栈溢出</span>
</code></pre></div><p>这是最基础的递归方法，我们分析一下 <code>fibonacci(5)</code> 具体的过程：</p> <ul><li>fibonacci(5) = fibonacci(4) + fibonacci(3);
<ul><li>fibonacci(4) = fibonacci(3) + fibonacci(2);
<ul><li>fibonacci(3) = fibonacci(2) + fibonacci(1);</li></ul></li> <li>fibonacci(3) = fibonacci(2) + fibonacci(1);</li></ul></li></ul> <p>可以看见有大量的重复计算，如果能将之前的计算结果缓存起来，应该会提高效率。</p> <h2 id="_2-正向叠加"><a href="#_2-正向叠加" class="header-anchor">#</a> 2.正向叠加</h2> <p>从 n = 1 开始计算，将计算过的值全部保存在数组中，这样在计算下一个值得时候，可以直接使用数组中存已存在的值进行计算。返回数组最后一个值就是我们要的结果。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fibArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fibArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            fibArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> fibArray<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> fibArray<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fibArray<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.272216796875ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.031005859375ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_3-动态规划"><a href="#_3-动态规划" class="header-anchor">#</a> 3.动态规划</h2> <p>这种方式比正向叠加将所有过程值存入数组更简单，每次只保存前两次的计算结果，因为只需要斐波那契数列计算只基于前两个值，所以没必要保存所有的过程值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> n1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        n2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
        sum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// n1,n2 向前移位</span>
        sum <span class="token operator">=</span> n1 <span class="token operator">+</span> n2<span class="token punctuation">;</span>
        n1 <span class="token operator">=</span> n2<span class="token punctuation">;</span>
        n2 <span class="token operator">=</span> sum<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.18603515625ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.020263671875ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_4-memoization"><a href="#_4-memoization" class="header-anchor">#</a> 4.Memoization</h2> <p>前面这两种方法，很好的提升了本次计算的效率问题。但是如果进行多次斐波那契数计算，就会发现，它们都是从 n = 1 开始计算的，并没有缓存起来以供下次计算。我们利用高阶函数和闭包可以缓存所以计算过的值，共多次斐波那契数计算使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> fibonacci <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// memo 是对象，比数组效率更高，</span>
    <span class="token comment">// 因为 memo 是数组时，首次计算，会生成一个全部是 undefined 的 长度为 n 的数组，</span>
    <span class="token comment">// 而 memo 是对象时，首次就是一个空对象。 </span>
    <span class="token keyword">let</span> memo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果尚未建立缓存</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">?</span> n <span class="token punctuation">:</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> memo<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.45703125ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.01611328125ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_5-memoization-封装"><a href="#_5-memoization-封装" class="header-anchor">#</a> 5.Memoization 封装</h2> <p>可以对 Memoization 这种方式进行封装，试用于更多的递归函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token function-variable function">memoize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> fibonacci <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">?</span> n <span class="token punctuation">:</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.633056640625ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.01806640625ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_6-underscore-中的-memoize"><a href="#_6-underscore-中的-memoize" class="header-anchor">#</a> 6.underscore 中的 _.memoize</h2> <p>underscore 中也有缓存函数功能的实现：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将函数（通常是递归函数）进行处理，返回带缓存的记忆函数，存储中间运算结果，提高效率。</span>
_<span class="token punctuation">.</span><span class="token function-variable function">memoize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> hasher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// hasher：自定义如何获得缓存的位置。</span>
  <span class="token keyword">var</span> <span class="token function-variable function">memoize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取缓存。</span>
    <span class="token keyword">var</span> cache <span class="token operator">=</span> memoize<span class="token punctuation">.</span>cache<span class="token punctuation">;</span>
    <span class="token comment">// 获得缓存地址，可以根据 hasher 来配置缓存的 key ,若没有配置，默认就是 key。</span>
    <span class="token keyword">var</span> address <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">(</span>hasher <span class="token operator">?</span> <span class="token function">hasher</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果没有该 address 对应的缓存，则调用函数进行计算。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">has</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">)</span> cache<span class="token punctuation">[</span>address<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 否则直接返回缓存。</span>
    <span class="token keyword">return</span> cache<span class="token punctuation">[</span>address<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 初始化调用 _.memoize 缓存对象，不是清除 memoize 中的缓存。</span>
  memoize<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> memoize<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fibonacci <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> n <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">?</span> n<span class="token punctuation">:</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.2412109375ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.008056640625ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_7-尾递归"><a href="#_7-尾递归" class="header-anchor">#</a> 7.尾递归</h2> <p>ES6 中有一个尾递归优化，递归非常耗费内存，因为需要同时保存成千上百个调用帧，很容易发生栈溢出错误。但对于尾递归来说，由于只存在一个调用帧，所以永远不会发生栈溢出错误。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> ac1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> ac2 <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> ac2 <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> ac2<span class="token punctuation">,</span> ac1 <span class="token operator">+</span> ac2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.10888671875ms</span>
console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 102334155</span>
console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">&quot;计算耗时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 计算耗时: 0.0283203125ms</span>
<span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 354224848179262000000</span>
</code></pre></div><h2 id="_8-通项公式"><a href="#_8-通项公式" class="header-anchor">#</a> 8.通项公式</h2> <p>斐波那契数列有<a href="https://baike.baidu.com/item/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97#2_2" target="_blank" rel="noopener noreferrer">通项公式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，但通项公式中有开方运算，在js中会存在误差，而fib函数中的Math.round正式解决这一问题的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> <span class="token function">fib</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token constant">SQRT_FIVE</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token constant">SQRT_FIVE</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">+</span> <span class="token constant">SQRT_FIVE</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">-</span> <span class="token constant">SQRT_FIVE</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/23/2018, 5:24:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/js/extends.html" class="prev">继承的多种方法总结</a></span> <span class="next"><a href="/blog/js/bracket.html">关于函数后括号省略的探究</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.b560a9ee.js" defer></script><script src="/blog/assets/js/2.465c49ea.js" defer></script><script src="/blog/assets/js/64.c47f0ec2.js" defer></script>
  </body>
</html>
